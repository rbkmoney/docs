# Создание рекуррента через проведение первого платежа

Рассмотрим кейс создания привязки покупателя для проведения рекуррентных платежей с помощью первого платежа.

Ниже приведен сценарий создания рекуррента через первый платеж с помощью методов API, предоставляемых платформой.

1. В платформе создается новый инвойс методом [`createInvoice`](https://developer.rbk.money/api/#operation/createInvoice). Инвойсу присваивается уникальный *invoiceId*.
2. Методом [`createCustomer`](https://developer.rbk.money/api/#operation/createCustomer) в платформе создается новый плательщик. Метод присваивает покупателю уникальный `id` и пользовательский токен доступа `customerAccessToken.payload`.
3. По полученным `id` и `customerAccessToken.payload` платформа формирует ссылку формы `Checkout`.
4. Мерчант предоставляет плательщику ссылку формы `Checkout`, в которой плательщик вводит данные платежного инструмента и указывает согласие для использования этого платежного инструмента в дальнейших безакцептных списаниях.
5. Форма `Checkout` внутренними алгоритмами формирует новый платеж методом [`createPayment`](https://developer.rbk.money/api/#operation/createPayment). В поле запроса `makeRecurrent` устанавливается параметр `true`.
   * В поле `type` указывается по какой схеме совершается платеж:
      - по одностадийной схеме `PaymentFlowInstant`;
      - по двухстадийной схеме `PaymentFlowHold`.
6. Платежу присваивается уникальный *id*.
7. Плательщик подтверждает списание платежных средств с помощью прохождения 3D-Secure.
8. Если платеж прошел успешно, то *invoiceId* и *id* платежа (п.6) в дальнейшем будут использоваться в качестве родительских.
   * При следующих платежах в объекте `Payer` будут указаны следующие данные:   
      "payerType": "RecurrentPayer",   
      "recurrentParentPayment":    
      "invoiceID": "*invoiceID* полученный при инициализирующем платеже",     
      "paymentID": "*id* инициализирующего платежа" 