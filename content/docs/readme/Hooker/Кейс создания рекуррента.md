Рассмотрим кейс создания привязки покупателя для проведения рекуррентных платежей.      
Webhook'и установлены на каждое возможное событие, предоставляеое платформой методом [`createWebhook`](https://developer.rbk.money/api/#operation/createWebhook). Мерчант может выбрать любые вебхуки из списка ниже:
* CustomerCreated - покупатель успешно создан;
* CustomerDeleted - покупатель успешно удален;
* CustomerReady - покупатель готов к проведению платежей, после биндинга;
* CustomerBindingStarted - создание связки начато;
* CustomerBindingSucceeded - связка успешно создана;
* CustomerBindingFailed - связка не создана по каким-либо причинам.

Обратная связь от webhook'ов поступает на бэкенд мерчанта с помощью сервиса `Hooker`.   
После срабатывания триггера любого webhook'а, мерчанту приходит об этом оповещение на указанный при добавлении webhook'а URL.

Ниже приведен сценарий создания связки плательщик - платежное средство для рекуррентного платежа с помощью методов API, предоставляемых платформой. Плательщик уже зарегистрирован в магазине мерчанта.

1. В платформе создается новый плательщик методом [`createCustomer`](https://developer.rbk.money/api/#operation/createCustomer), после чего происходит срабатывание триггера webhook'а `CustomerCreated`. Метод присваивает покупателю уникальный `id` и пользовательский токен доступа `customerAccessToken.payload`.
2. По полученным `id` и `customerAccessToken.payload` платформа формирует ссылку формы `Checkout` для создания связки плательщик - платежное средство.
4. Мерчант предоставляет плательщику ссылку формы `Checkout`, в которой плательщик вводит данные платежного инструмента. 
5. Мерчант методом [`createPaymentResource`](https://developer.rbk.money/api/#operation/createPaymentResource) создает в платформе платежный инструмент покупателя по указанным в форме `Checkout` данным. После выполнения метода создается токен платежного средства `paymentToolToken`.
6. Мерчант методом [`createBinding`](https://developer.rbk.money/api/#operation/createBinding) создает привязку пользователя к платежному инструменту, что активизирует триггер вебхука `CustomerBindingStarted`.
7. Проводится авторизация плательщика методом холдирования платежных средств на платежном инструменте. 
   - Если во время авторизации произошла ошибка - это активирует триггер webhook'а `CustomerBindingFailed` и в ответе на запрос  в строке "status" указывается значение "failed". <!-- авторизация не прошла --> 
8. Банк - эмитент направляет сообщение по протоколу [3D-Secure](https://en.wikipedia.org/wiki/3-D_Secure).
9. С платежного средства плательщика будет списано 10 рублей (если валюта магазина мерчанта - рубли, 1 евро (если валюта магазина мерчанта - евро) или 1 доллар (если валюта магазина мерчанта - доллар). После чего списанные средства поступают обратно на платежное средство плательщика. 
10. При успешно созданной связке, активируется триггер вебхука `CustomerBindingSucceeded`. В ответе на запрос  в строке "status" указывается значение "succeeded". 
11. После создания связки активируется триггер webhook'а `Customer Ready`.
12. Если хранящаяся в платформе связка покупатель - платежное средство будет удалена методом [deleteCustomer](https://developer.rbk.money/api/#operation/deleteCustomer), в котором указывается уникальный идентификатор покупателя, это послужит триггером для webhook'а `CustomerDeleted`.
