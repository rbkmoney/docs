Рассмотрим кейс обычного платежа плательщика мерчанту через платформу. 
Мерчант решил установить webhook'и (в личном кабинете) на все возможные события, предоставляемые платформой (мерчант может выбрать любой набор webhook'ов для необходимых событий). Также мерчант может установить необходимые webhook'и, используя API, методом [CreateWebhok](https://developer.rbk.money/api/#operation/createWebhook) и, указывая необходимые параметры.   
Обратная связь от webhook'ов поступает на бэкенд мерчата с помощью сервиса `Hooker`.   
После срабатывания триггера любого webhook'а, мерчанту приходит об этом оповещение на указанный при добавлении webhook'а URL.
Ниже представлен сценарий проведения платежа с указанием событий, активирующих определенные webhook'и.   
Возможно создать webhook'и для нижеперечисленных событий:
* InvoiceCreated - создан новый инвойс;
* InvoicePaid - инвойс перешел в состояние "Оплачен";
* InvoiceCancelled - инвойс отменен по истечению срока давности;
* InvoiceFulfilled - инвойс успешно погашен;
* PaymentStarted - создан платеж;
* PaymentProcessed - платеж обработан;
* PaymentCaptured - платеж успешно завершен;
* PaymentCancelled - платеж успешно отменен;
* PaymentRefunded - платеж успешно возвращен;
* PaymentFailed - при проведении платежа возникла ошибка;
* PaymentRefundCreated - возврат платежа успешно создан; 
* PaymentRefundSucceeded - возврат платежа прошел успешно;
* PaymentRefundFailed - возврат платежа завершился неудачей.

1. Плательщик выбрал в магазине мерчанта необходимый товар, добавил его в корзину, готов перейти к процедуре оплаты.
2. Бэкенд мерчанта методом [createInvoice](https://developer.rbk.money/api/#operation/createInvoice) создает инвойс с указанием окончания срока действия. Платформа возвращает бэкенду мерчанта сформированный инвойс, ключ для доступа к инвойсу - `invoiceAccessToken` и платежную ссылку.
3. Срабатывает триггер webhook'а `InvoiceCreated (Создан новый инвойс)`.
4. Бэкенд мерчанта направляет плательщику платежную ссылку, при переходе по которой у плательщика появится форма `Checkout`. Плательщик вводит необходимые для оплаты данные и нажимает кнопку оплаты. 
    - Если покупатель не ввел в форму `Checkout` данные об оплате в течении заданного мерчантом времени, инвойс переходит в статус "Отменен" и срабатывает триггер webhook'а `InvoiceCancelled (инвойс отменен по истечению срока давности)`.
5. По введенным в форму `Checkout` данным внутренние методы  платформы вызывают метод [createPaymentResource](https://developer.rbk.money/api/#operation/createPaymentResource). <!-- исправил с createPaymentToolToken ошибка в схеме-->  В платформе создается одноразовый токен платежного средства `paymentToolToken`, предоставленного плательщиком, а также новая уникальная платежная сессия `paymentToolSession`.
6. Бэкенд мерчанта методом  [createPayment](https://developer.rbk.money/api/#operation/createPayment) создает в платформе новый платеж и передает следующие токены платформе: `invoiceAccessToken`, `paymentToolToken` и `paymentToolSession`. Срабатывает триггер webhook'а `PaymentStarted (создан платеж)`. 
7. Проводится авторизация плательщика методом холдирования платежных средств на платежном инструменте.
   - Если не получилось произвести процедуру холдировнаия платежных средств (например, неправильно введен номер карты или недостаточно средств на счете), то срабатывает триггер webhook'а `PaymentFailed (при проведении платежа возникла ошибка)`.
8. При успешном прохождении холдирования срабатывает триггер webhook'а `PaymentProcessed (платеж обработан)`.
   - Если после ввода платежных данных плательщик решает отменить платеж, то это вызывает срабатывание триггера webhook'а `PaymentCancelled (платеж успешно отменен)`.  
9. Мерчант может проверить корректность платежа webhook'ом `PaymentCaptured (платеж успешно завершен)`. Инвойс переходит в статус "Оплачен". Так же успешность платежа можно проверить вызовом webhook'а `InvoicePaid (инвойс перешел в состояние "Оплачен")`. После этого мерчант может собственноручно перевести инвойс в статус "Погашен", после чего сработает триггер webhook'а `InvoiceFulfilled (инвойс успешно погашен)`.
