## Регистрация в личном кабинете

Перед началом работы с платформой вам будет необходимо пройти регистрацию в [личном кабинете мерчанта](https://dashboard.rbk.money/). 

!!! note "Мерчант (Merchant)"
    Участник технического и финансового взаимодействия, предоставляющий товары и услуги, выставляющий инвойсы и имеющий возможность вывести средства из системы.

!!! note "Платформа (Platform)"
    Программно-аппаратный комплекс RBKmoney, обеспечивающий техническую реализацию бизнес-процессов по приему платежей

## Магазины

Магазин – это способ обобщения товаров и услуг, объединённых одной категорией, которые вы продаете вашим клиентам. К конкретным магазинам привязаны ваши счета, на которых аккумулируются средства плательщиков, впоследствии перечисляемые вам с помощью банковских переводов или других средств вывода.

!!! note "Плательщик (Payer)"
    Физическое лицо, покупатель ваших товаров и услуг, который владеет платёжными средствами и участвует в процессах оплаты созданных вами инвойсов. Уникальным обязательным идентификатором плательщика в системе является его email.

Магазины могут быть тестовыми и активными. Тестовый магазин – магазин с тестовой категорией товаров или услуг, по которому разрешен запуск платежей только с использованием [тестовых банковских карт](/refs/testcards/), а также запрещены процессы вывода средств с помощью банковских переводов.

!!! note "Информация"
    Тестовые магазины используют ту же производственную среду, что и активные, поэтому их можно использовать для мониторинга доступности платформы.

Если вы зарегистрировались в личном кабинете, у вас уже есть ваш первый тестовый магазин.

## Инвойсы

Платформа использует инвойс, как отражение ваших обязательств в виде предлагаемых товаров или услуг, некий контейнер для запуска и обработки платежей. Перед встраиванием платежной формы в браузер плательщика, или попытками списать средства с его платежного инструмента на вашей серверной части, необходимо создать в платформе инвойс и получить его идентификатор.

!!! note "Платёж (Payment)"
    Процесс в рамках инвойса, в ходе которого средства плательщика поступают в вашу пользу в виде финансовых обязательств платформы. После того, как инвойс полностью оплачен, вы должны приступить к исполнению своих обязательств перед плательщиком, например направить товар в службу доставки или оказать обещанную услугу.

В магазине, в рамках которого вы создаёте инвойсы, на ваше усмотрение вы можете включить доставку callback-уведомлений на указанный вами URL вашей серверной части. Платформа отправляет подобные уведомления, чтобы как можно скорее уведомить о важных изменениях инвойса, например, по факту полной его оплаты.

## Прием платежей

В общем случае последовательность действий с платформой выглядит так:

- С помощью вызова нашего API вы создаете в платформе инвойс, который используется для дальнейшего списания средств.
- Вы встраиваете платежную форму в браузер плательщика, а именно:
    - открываете iframe с нашей платежной формой и передаете в него параметры, или
    - верстаете платежную форму самостоятельно и вызываете ее с ваших серверов.
- После ввода плательщиком данных банковской карты на платежной форме наша библиотека tokenizer.js отправляет полученные данные на нашу серверную часть, и получает в ответ токен платежного средства.
- Платёжная форма передает полученный токен на вашу серверную часть.
- С вашей серверной стороны вы инициируете запуск платежа, после чего начинаете опрашивать изменения состояния инвойса или ожидает callback-уведомлений.

### Диаграмма последовательности взаимодействия

В качестве примера проведения успешной оплаты с использованием callback-уведомлений можно рассмотреть следующую диаграмму:

!!! note "Информация"
    Callback-уведомления являются синхронными, то есть платформа посчитает инвойс оплаченным только после того, как успешно доставит соответствующее уведомление до вашей серверной части.

  ![/wsd/custom_form_w_cb.png](/wsd/custom_form_w_cb.png)

## Авторизация запросов

Для того, чтобы платформа могла авторизовать вызываемые вами методы нашего API, необходимо с каждым запросом передать соответствующий ключ. В зависимости от выполняемых операций вам могут понадобиться различные ключи.

### API-ключ

Ваш приватный ключ (_API Token_), используемый для авторизации вашей серверной части. Этот ключ используется для наиболее критичных действий, таких, как создание инвойса. Этот ключ должен быть доступен и известен только вам.

### Ключ для доступа к инвойсу

Ключ (_Invoice Access Token_), который позволяет получить доступ к инвойсу. С помощью этого ключа можно авторизовать ограниченное количество операций, необходимых для проведения платежей по указанному инвойсу.

Данный ключ использует платежная форма Checkout, и библиотека токенизации платежного инструмента плательщика Tokenizer. Вы можете публиковать этот ключ.

## Авторизация callback-уведомлений

В обратной ситуации, в тех случаях, когда ваша серверная часть получает callback-уведомления на указанный вами URL, вам необходимо убедиться, что уведомление действительно было отправлено платформой. Для решения этой задачи в каждом магазине указан публичный ключ (_Callback Key_), служащий для проверки подписи, передаваемой с каждым callback-уведомлением.

## Сценарии интеграции

- Вы хотите интегрировать готовую платежную форму Checkout, которая обеспечивает оркестрацию всего процесса платежа? Вам [сюда](/integrations/checkout).
- Вы хотите интегрировать вашу кастомную платежную форму с платформой? Тогда вам [сюда](/integrations/tokenizer).

## Тестирование API с помощью [Postman](https://www.getpostman.com/)

- Postman предоставляет удобный GUI для работы с API подобными нашему и позволяет делать подстановку переменных из результатов выполненного запроса в последующие, что удобно при выполнении каскадных вызовов API.
- Для этого импортируйте [коллекцию RBKMoney API](/postman/RBKMoney Public API.postman_collection.json) и [переменные окружения](/postman/RBKmoney Environment.postman_environment.json) в ваш экземпляр программы.

!!! note "Подсказка" 
	Удобнее всего скопировать ссылки на [коллекцию](/postman/RBKMoney Public API.postman_collection.json) и [переменные окружения](/postman/RBKmoney Environment.postman_environment.json) и импортировать их, вставив через меню _File->Import->Import From Link_

- Выберите &#9881;_->Manage Environments->RBKmoney Environment_ и замените значение **api_key** на ваш [API-ключ](https://dashboard.rbk.money/tokenization), а также **notifications_email** на адрес вашей почты, если хотите получать уведомления о платежах и инвойсах от платформы.
- Другие значения ключей изменять не нужно, их значения Postman подставит автоматически при вызове соответствующих методов API.
- Запустите Runner, выберите коллекцию _RBKMoney Public API_, выберите окружение _RBKmoney Environment_ и нажмите _Start Run_ для проведения вызовов всех методов API последовательно. В тестовом магазине вашего [личного кабинета](https://dashboard.rbk.money/analytics/1/finance) появится успешно оплаченный инвойс с описанием "Postman description"